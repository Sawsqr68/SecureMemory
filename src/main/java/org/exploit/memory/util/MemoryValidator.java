package org.exploit.memory.util;

import org.exploit.memory.exception.MemoryNotAlignedException;
import org.exploit.memory.exception.MemoryNotReadableException;
import org.exploit.memory.exception.MemoryNotWriteableException;

import static org.exploit.memory.constant.Access.READ;
import static org.exploit.memory.constant.Access.WRITE;

public final class MemoryValidator {
    private MemoryValidator() {}

    public static void ensureWritable(int protectionFlags) {
        if (protectionFlags == -1)
            return;

        if ((protectionFlags & WRITE) == 0)
            throw new MemoryNotWriteableException();
    }

    public static void ensureReadable(int protectionFlags) {
        if (protectionFlags == -1)
            return;

        if ((protectionFlags & READ) == 0)
            throw new MemoryNotReadableException();
    }

    public static void ensureRW(int protectionFlags) {
        ensureReadable(protectionFlags);
        ensureWritable(protectionFlags);
    }

    public static void ensureCapacity(int requiredSize, int size) {
        if (requiredSize > size)
            throw new IllegalArgumentException("Buffer overflow. Required size: " + requiredSize + ", but got: " + size);
    }

    public static void ensurePageAligned(int size) {
        if (size % MemoryUtil.pageSize() != 0)
            throw new MemoryNotAlignedException(size, MemoryUtil.pageSize());
    }

}
